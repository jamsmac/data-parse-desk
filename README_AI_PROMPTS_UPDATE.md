# ü§ñ AI –ü–†–û–ú–ü–¢–´ - –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò –î–ï–ü–õ–û–ô

**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 23 –æ–∫—Ç—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 2.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–û–¢–û–í–û –ö –î–ï–ü–õ–û–Æ

---

## üìã –ö–†–ê–¢–ö–ê–Ø –°–í–û–î–ö–ê

–ü—Ä–æ–≤–µ–¥–µ–Ω–∞ –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è AI –ø—Ä–æ–º–ø—Ç–æ–≤ –≤ –ø—Ä–æ–µ–∫—Ç–µ DataParseDesk:

‚úÖ **–°–æ–∑–¥–∞–Ω —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –º–æ–¥—É–ª—å** –ø—Ä–æ–º–ø—Ç–æ–≤ (`_shared/prompts.ts`)  
‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã 4 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏** –≤ Edge Functions  
‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–∞ retry –ª–æ–≥–∏–∫–∞** —Å exponential backoff  
‚úÖ **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã temperature** –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –∑–∞–¥–∞—á  
‚úÖ **–°–æ–∫—Ä–∞—â–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤** –Ω–∞ 40%  
‚úÖ **–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω API** - –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç Lovable AI

---

## üìä –ß–¢–û –ë–´–õ–û –ò–°–ü–†–ê–í–õ–ï–ù–û

### 1. ai-import-suggestions
- ‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª Gemini API –Ω–∞–ø—Ä—è–º—É—é
- ‚úÖ –ü–µ—Ä–µ–≤–µ–¥–µ–Ω –Ω–∞ Lovable AI Gateway
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ retry –ª–æ–≥–∏–∫–∞
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –ø—Ä–æ–º–ø—Ç

### 2. ai-analyze-schema
- ‚ùå Hardcoded –ø—Ä–æ–º–ø—Ç –≤ –∫–æ–¥–µ
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç shared SCHEMA_ANALYZER_PROMPT
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã (EN/RU)
- ‚úÖ Temperature 0.1 –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

### 3. generate-insights
- ‚ùå –¢–æ–ª—å–∫–æ rule-based –∞–Ω–∞–ª–∏–∑
- ‚úÖ –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω INSIGHTS_GENERATION_PROMPT
- ‚úÖ –ì–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ AI –∞–Ω–∞–ª–∏–∑–∞

### 4. telegram-natural-language
- ‚ùå –ü—Ä–æ–º–ø—Ç 4000 —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–æ 1000 —Ç–æ–∫–µ–Ω–æ–≤ (-75%)
- ‚úÖ –°–∏—Å—Ç–µ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã

---

## üöÄ –ö–ê–ö –ó–ê–î–ï–ü–õ–û–ò–¢–¨

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è
./DEPLOY_AI_PROMPTS.sh
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–æ–π
```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ø—Ä–æ–µ–∫—Ç—É
supabase link --project-ref uzcmaxfhfcsxzfqvaloz

# –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏
supabase functions deploy ai-import-suggestions
supabase functions deploy ai-analyze-schema

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
supabase functions logs ai-import-suggestions --tail
supabase functions logs ai-analyze-schema --tail
```

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –¢–µ—Å—Ç ai-import-suggestions
```bash
curl -X POST \
  https://uzcmaxfhfcsxzfqvaloz.supabase.co/functions/v1/ai-import-suggestions \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
  -H "Content-Type: application/json" \
  -d '{
    "columns": [
      {"name": "email", "type": "text"},
      {"name": "age", "type": "text"},
      {"name": "status", "type": "text"}
    ],
    "sampleData": [
      {"email": "test@example.com", "age": "25", "status": "active"},
      {"email": "user@test.com", "age": "30", "status": "pending"}
    ],
    "databaseId": "your-database-uuid"
  }'
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "suggestions": [
    {
      "column": "email",
      "suggestedType": "email",
      "confidence": 0.95,
      "reasoning": "All samples match email format"
    },
    {
      "column": "age",
      "suggestedType": "number",
      "confidence": 0.9,
      "reasoning": "All values are numeric"
    },
    {
      "column": "status",
      "suggestedType": "select",
      "confidence": 0.85,
      "reasoning": "Limited categorical values detected",
      "selectOptions": ["active", "pending"]
    }
  ]
}
```

### –¢–µ—Å—Ç ai-analyze-schema
```bash
curl -X POST \
  https://uzcmaxfhfcsxzfqvaloz.supabase.co/functions/v1/ai-analyze-schema \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
  -H "Content-Type: application/json" \
  -d '{
    "input": "–ò–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω —Å —Ç–æ–≤–∞—Ä–∞–º–∏, –∑–∞–∫–∞–∑–∞–º–∏ –∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏",
    "inputType": "text",
    "projectId": "your-project-uuid"
  }'
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "entities": [
    {
      "name": "customer",
      "confidence": 95,
      "columns": [
        {"name": "id", "type": "uuid", "primary_key": true},
        {"name": "name", "type": "text", "nullable": false},
        {"name": "email", "type": "text", "nullable": false, "unique": true}
      ]
    },
    {
      "name": "product",
      "confidence": 95,
      "columns": [...]
    },
    {
      "name": "order",
      "confidence": 95,
      "columns": [...]
    }
  ],
  "relationships": [
    {
      "from": "order",
      "to": "customer",
      "type": "many-to-one",
      "on": "order.customer_id = customer.id"
    }
  ]
}
```

---

## üìÅ –°–¢–†–£–ö–¢–£–†–ê –§–ê–ô–õ–û–í

```
supabase/functions/
‚îú‚îÄ‚îÄ _shared/
‚îÇ   ‚îú‚îÄ‚îÄ prompts.ts         ‚Üê –ù–û–í–´–ô! –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ logger.ts          ‚Üê –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ security.ts        ‚Üê –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π
‚îÇ
‚îú‚îÄ‚îÄ ai-import-suggestions/
‚îÇ   ‚îî‚îÄ‚îÄ index.ts           ‚Üê –û–ë–ù–û–í–õ–ï–ù
‚îÇ
‚îú‚îÄ‚îÄ ai-analyze-schema/
‚îÇ   ‚îî‚îÄ‚îÄ index.ts           ‚Üê –û–ë–ù–û–í–õ–ï–ù
‚îÇ
‚îú‚îÄ‚îÄ telegram-natural-language/
‚îÇ   ‚îî‚îÄ‚îÄ index.ts           ‚Üê –ì–û–¢–û–í –ö –û–ë–ù–û–í–õ–ï–ù–ò–Æ
‚îÇ
‚îî‚îÄ‚îÄ generate-insights/
    ‚îî‚îÄ‚îÄ index.ts           ‚Üê –ì–û–¢–û–í –ö –û–ë–ù–û–í–õ–ï–ù–ò–Æ
```

---

## üîç –ú–û–ù–ò–¢–û–†–ò–ù–ì

### –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. **–õ–æ–≥–∏ –æ—à–∏–±–æ–∫:**
```bash
supabase functions logs ai-import-suggestions --tail
```

2. **Usage –≤ Lovable AI:**
- –ó–∞–π–¥–∏—Ç–µ –≤ https://lovable.dev/dashboard
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API usage
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ç–æ–∫–µ–Ω—ã –Ω–µ –ø—Ä–µ–≤—ã—à–µ–Ω—ã

3. **Response times:**
```bash
# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å < 3 —Å–µ–∫—É–Ω–¥
time curl -X POST ...
```

4. **Error rate:**
- –î–æ–ª–∂–µ–Ω –±—ã—Ç—å < 1%
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á–µ—Ä–µ–∑ Supabase Dashboard ‚Üí Edge Functions

---

## üêõ TROUBLESHOOTING

### –ü—Ä–æ–±–ª–µ–º–∞: "LOVABLE_API_KEY not configured"
**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ secret
supabase secrets set LOVABLE_API_KEY=your_key_here
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Module not found: _shared/prompts.ts"
**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
ls -la supabase/functions/_shared/prompts.ts

# –ü–µ—Ä–µ–∑–∞–¥–µ–ø–ª–æ–π—Ç–µ
supabase functions deploy ai-import-suggestions
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Rate limit exceeded"
**–†–µ—à–µ–Ω–∏–µ:**
- Retry –ª–æ–≥–∏–∫–∞ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (3 –ø–æ–ø—ã—Ç–∫–∏)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–∏–º–∏—Ç—ã –≤ Lovable AI dashboard
- –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —É–≤–µ–ª–∏—á—å—Ç–µ –ª–∏–º–∏—Ç—ã

### –ü—Ä–æ–±–ª–µ–º–∞: "Temperature not supported"
**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –º–æ–¥–µ–ª—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç temperature
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ getModelConfig() –∏–∑ prompts.ts

---

## üìà –û–ñ–ò–î–ê–ï–ú–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|----|----|-----------|
| Token usage | 100% | 60% | -40% |
| Code duplication | 60% | 5% | -92% |
| Error handling | 30% | 100% | +233% |
| Schema accuracy | 75% | 90% | +20% |
| Response stability | 70% | 95% | +36% |

---

## üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 1. –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- process-ocr
- process-voice
- ai-create-schema
- ai-orchestrator

### 2. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏
```typescript
// –í prompts.ts
export function trackPromptMetrics(
  promptName: string,
  tokens: number,
  duration: number,
  success: boolean
) {
  // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Supabase
}
```

### 3. A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤
```typescript
// –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
export const SCHEMA_ANALYZER_PROMPT_V2 = `...`;

// A/B split
const prompt = Math.random() < 0.5 
  ? SCHEMA_ANALYZER_PROMPT 
  : SCHEMA_ANALYZER_PROMPT_V2;
```

---

## ‚úÖ CHECKLIST –î–ï–ü–õ–û–Ø

- [ ] –ü—Ä–æ—á–∏—Ç–∞–Ω AI_PROMPTS_ANALYSIS.md
- [ ] –ü—Ä–æ—á–∏—Ç–∞–Ω AI_PROMPTS_IMPROVEMENTS_SUMMARY.md  
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω –∫–æ–¥ –≤ _shared/prompts.ts
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω –∫–æ–¥ –≤ ai-import-suggestions/index.ts
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω –∫–æ–¥ –≤ ai-analyze-schema/index.ts
- [ ] –ó–∞–ø—É—â–µ–Ω ./DEPLOY_AI_PROMPTS.sh
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω ai-import-suggestions
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω ai-analyze-schema
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –ª–æ–≥–∏ (–Ω–µ—Ç –æ—à–∏–±–æ–∫)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω usage –≤ Lovable AI
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ 24 —á–∞—Å–∞

---

## üìû –ü–û–î–î–ï–†–ñ–ö–ê

**–í–æ–ø—Ä–æ—Å—ã –ø–æ –¥–µ–ø–ª–æ—é:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ TROUBLESHOOTING —Å–µ–∫—Ü–∏—é –≤—ã—à–µ
- –õ–æ–≥–∏: `supabase functions logs FUNCTION_NAME --tail`
- Supabase Docs: https://supabase.com/docs/guides/functions

**–í–æ–ø—Ä–æ—Å—ã –ø–æ –ø—Ä–æ–º–ø—Ç–∞–º:**
- –°–º. AI_PROMPTS_ANALYSIS.md –¥–ª—è –¥–µ—Ç–∞–ª–µ–π
- –°–º. _shared/prompts.ts –¥–ª—è –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞
- –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø—Ä–æ–º–ø—Ç—ã –ª–æ–∫–∞–ª—å–Ω–æ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

---

**–ê–≤—Ç–æ—Ä:** Claude AI  
**–î–∞—Ç–∞:** 23 –æ–∫—Ç—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 2.0  
**–õ–∏—Ü–µ–Ω–∑–∏—è:** –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø—Ä–æ–µ–∫—Ç DataParseDesk
