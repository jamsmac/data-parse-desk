
 RUN  v3.2.4 /workspace/data-parse-desk

 ✓ tests/memory-leaks.test.tsx (11 tests) 13ms
 ✓ src/api/__tests__/databaseAPI.test.ts (24 tests) 11ms
 ❯ tests/regression/aurora-fixes.test.ts (15 tests | 3 failed) 26ms
   ✓ Aurora Fixes - Regression Tests > CSS Imports Order > should have @import statements before other CSS rules 2ms
   ✓ Aurora Fixes - Regression Tests > React.memo Usage > should wrap GlassCard subcomponents in React.memo 0ms
   ✓ Aurora Fixes - Regression Tests > useEffect Cleanup > should have cleanup in AuroraBackground useEffect 1ms
   × Aurora Fixes - Regression Tests > useEffect Cleanup > should have cleanup in AnimatedList IntersectionObserver 13ms
     → expected 'import React from \'react\';\n\nexpor…' to contain 'IntersectionObserver'
   ✓ Aurora Fixes - Regression Tests > useEffect Cleanup > should have cleanup in useReducedMotion hook 0ms
   × Aurora Fixes - Regression Tests > prefers-reduced-motion Support > should import useReducedMotion in FadeIn 6ms
     → expected 'import React from \'react\';\n\nexpor…' to contain 'import { useReducedMotion } from \'@/…'
   ✓ Aurora Fixes - Regression Tests > prefers-reduced-motion Support > should import useReducedMotion in StaggerChildren 0ms
   ✓ Aurora Fixes - Regression Tests > ErrorBoundary Component > should have ErrorBoundary component 0ms
   ✓ Aurora Fixes - Regression Tests > ErrorBoundary Component > should export ErrorBoundary from aurora index 0ms
   ✓ Aurora Fixes - Regression Tests > Accessibility Features > should have keyboard support in GlassCard interactive variant 0ms
   ✓ Aurora Fixes - Regression Tests > Accessibility Features > should have keyboard support in FluidButton 0ms
   ✓ Aurora Fixes - Regression Tests > Performance Optimizations > should use memo for DataTable 0ms
   ✓ Aurora Fixes - Regression Tests > Performance Optimizations > should have backdrop-filter fallback in GlassCard 0ms
   ✓ Aurora Fixes - Regression Tests > Configuration Files > should have aurora-fixes.config.ts 0ms
   × Aurora Fixes - Regression Tests > Code Quality > should have displayName for all Aurora components 1ms
     → expected 'import React from \'react\';\n\nexpor…' to contain '.displayName ='
 ✓ src/api/__tests__/relationAPI.test.ts (27 tests) 12ms
 ✓ src/utils/__tests__/columnMapper.test.ts (8 tests) 4ms
 ✓ src/api/__tests__/fileAPI.test.ts (26 tests) 25ms
stderr | src/utils/__tests__/formulaEngine.test.ts > FormulaEngine > calculateFormula > Обработка ошибок > должен возвращать ошибку при неизвестной функции
Ошибка вычисления формулы: Error: Unknown function: unknown_func
    at parsePrimary (/workspace/data-parse-desk/src/utils/formulaEngine.ts:400:15)
    at parseUnary (/workspace/data-parse-desk/src/utils/formulaEngine.ts:346:12)
    at parseMulDiv (/workspace/data-parse-desk/src/utils/formulaEngine.ts:319:16)
    at parseAddSub (/workspace/data-parse-desk/src/utils/formulaEngine.ts:296:16)
    at parseComparison (/workspace/data-parse-desk/src/utils/formulaEngine.ts:265:16)
    at parseEquality (/workspace/data-parse-desk/src/utils/formulaEngine.ts:247:16)
    at parseAnd (/workspace/data-parse-desk/src/utils/formulaEngine.ts:235:16)
    at parseOr (/workspace/data-parse-desk/src/utils/formulaEngine.ts:223:16)
    at parseExpression (/workspace/data-parse-desk/src/utils/formulaEngine.ts:219:12)
    at evaluate (/workspace/data-parse-desk/src/utils/formulaEngine.ts:444:10)

 ✓ src/utils/__tests__/formulaEngine.test.ts (37 tests) 18ms
 ✓ src/utils/__tests__/parseData.test.ts (30 tests) 31ms
 ✓ src/components/aurora/__tests__/Animations.test.tsx (35 tests) 141ms
 ✓ src/components/aurora/__tests__/AuroraBackground.test.tsx (29 tests) 561ms
 ✓ src/components/aurora/__tests__/GlassCard.test.tsx (30 tests) 114ms
 ✓ src/components/common/__tests__/LoadingSpinner.test.tsx (3 tests) 135ms
 ✓ src/components/ui/__tests__/button.test.tsx (4 tests) 120ms
 ❯ src/utils/__tests__/fileParser.test.ts (14 tests | 1 failed) 14709ms
   ✓ FileParser > parseFile > CSV файлы > должен парсить простой CSV файл 3ms
   ✓ FileParser > parseFile > CSV файлы > должен обрабатывать CSV с запятыми в кавычках 1ms
   ✓ FileParser > parseFile > CSV файлы > должен обрабатывать пустые значения в CSV 1ms
   ✓ FileParser > parseFile > CSV файлы > должен обрабатывать различные разделители строк 0ms
   ✓ FileParser > parseFile > CSV файлы > должен обрабатывать Unicode символы 0ms
   ✓ FileParser > parseFile > Excel файлы > должен отклонять файлы Excel (временно не поддерживается) 0ms
   ✓ FileParser > parseFile > Обработка ошибок > должен отклонять файлы неподдерживаемых форматов 1ms
   ✓ FileParser > parseFile > Обработка ошибок > должен отклонять пустые файлы 0ms
   × FileParser > parseFile > Обработка ошибок > должен проверять размер файлов 14672ms
     → Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
   ✓ FileParser > parseFile > Нормализация данных > должен добавлять нормализованные поля даты 20ms
   ✓ FileParser > parseFile > Нормализация данных > должен добавлять нормализованные поля суммы 1ms
   ✓ FileParser > parseFile > Нормализация данных > должен генерировать уникальные ID для строк 1ms
   ✓ FileParser > parseFile > Производительность > должен обрабатывать большие файлы эффективно 7ms
   ✓ FileParser > parseFile > Совместимость с различными кодировками > должен корректно читать UTF-8 1ms

⎯⎯⎯⎯⎯⎯⎯ Failed Tests 4 ⎯⎯⎯⎯⎯⎯⎯

 FAIL  tests/regression/aurora-fixes.test.ts > Aurora Fixes - Regression Tests > useEffect Cleanup > should have cleanup in AnimatedList IntersectionObserver
AssertionError: expected 'import React from \'react\';\n\nexpor…' to contain 'IntersectionObserver'

- Expected
+ Received

- IntersectionObserver
+ import React from 'react';
+
+ export interface AnimatedListProps {
+   children: React.ReactNode;
+   className?: string;
+   direction?: string;
+   stagger?: number;
+ }
+
+ export function AnimatedList({ children, className }: AnimatedListProps) {
+   return <div className={className}>{children}</div>;
+ }
+

 ❯ tests/regression/aurora-fixes.test.ts:68:23
     66| 
     67|       // Проверяем наличие cleanup для IntersectionObserver
     68|       expect(content).toContain('IntersectionObserver');
       |                       ^
     69|       expect(content).toContain('observer.disconnect()');
     70|       expect(content).toContain('return () => observer.disconnect()');

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/4]⎯

 FAIL  tests/regression/aurora-fixes.test.ts > Aurora Fixes - Regression Tests > prefers-reduced-motion Support > should import useReducedMotion in FadeIn
AssertionError: expected 'import React from \'react\';\n\nexpor…' to contain 'import { useReducedMotion } from \'@/…'

- Expected
+ Received

- import { useReducedMotion } from '@/hooks/aurora/useReducedMotion'
+ import React from 'react';
+
+ export interface FadeInProps {
+   children: React.ReactNode;
+   direction?: 'up' | 'down' | 'left' | 'right' | 'none';
+   delay?: number;
+   duration?: number;
+   distance?: number;
+   once?: boolean;
+   className?: string;
+   viewport?: boolean;
+ }
+
+ export function FadeIn({ children, className }: FadeInProps) {
+   return <div className={className}>{children}</div>;
+ }
+

 ❯ tests/regression/aurora-fixes.test.ts:88:23
     86|       const content = readFileSync(fadeInPath, 'utf-8');
     87| 
     88|       expect(content).toContain("import { useReducedMotion } from '@/h…
       |                       ^
     89|       expect(content).toContain('const prefersReducedMotion = useReduc…
     90|       expect(content).toContain('prefersReducedMotion ?');

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/4]⎯

 FAIL  tests/regression/aurora-fixes.test.ts > Aurora Fixes - Regression Tests > Code Quality > should have displayName for all Aurora components
AssertionError: expected 'import React from \'react\';\n\nexpor…' to contain '.displayName ='

- Expected
+ Received

- .displayName =
+ import React from 'react';
+
+ export interface FadeInProps {
+   children: React.ReactNode;
+   direction?: 'up' | 'down' | 'left' | 'right' | 'none';
+   delay?: number;
+   duration?: number;
+   distance?: number;
+   once?: boolean;
+   className?: string;
+   viewport?: boolean;
+ }
+
+ export function FadeIn({ children, className }: FadeInProps) {
+   return <div className={className}>{children}</div>;
+ }
+

 ❯ forEach tests/regression/aurora-fixes.test.ts:188:25
    186|         const fullPath = join(projectRoot, componentPath);
    187|         const content = readFileSync(fullPath, 'utf-8');
    188|         expect(content).toContain('.displayName =');
       |                         ^
    189|       });
    190|     });
 ❯ tests/regression/aurora-fixes.test.ts:185:18

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/4]⎯

 FAIL  src/utils/__tests__/fileParser.test.ts > FileParser > parseFile > Обработка ошибок > должен проверять размер файлов
Error: Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 ❯ src/utils/__tests__/fileParser.test.ts:126:7
    124|       });
    125| 
    126|       it('должен проверять размер файлов', async () => {
       |       ^
    127|         // Создаем файл больше 50MB
    128|         const largeContent = new Array(60 * 1024 * 1024).fill('a').joi…

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[4/4]⎯


 Test Files  2 failed | 12 passed (14)
      Tests  4 failed | 289 passed (293)
   Start at  11:32:19
   Duration  17.25s (transform 497ms, setup 1.55s, collect 1.18s, tests 15.92s, environment 5.25s, prepare 973ms)

