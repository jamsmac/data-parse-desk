# ü§ñ –ê–ù–ê–õ–ò–ó AI –ü–†–û–ú–ü–¢–û–í - –û–®–ò–ë–ö–ò –ò –ù–ï–î–û–†–ê–ë–û–¢–ö–ò

**–î–∞—Ç–∞:** 23 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** üî¥ –¢–†–ï–ë–£–Æ–¢ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

---

## üìä –û–ë–ù–ê–†–£–ñ–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –û–®–ò–ë–ö–ò:

#### 1. **ai-analyze-schema** - –ù–µ–ø–æ–ª–Ω—ã–π –ø—Ä–æ–º–ø—Ç
**–§–∞–π–ª:** `supabase/functions/ai-analyze-schema/index.ts:9-84`

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–Ω–æ–≥–æ–∑–Ω–∞—á–Ω—ã—Ö entity names (singular vs plural)
- ‚ùå –ü—Ä–æ–º–ø—Ç —Ç—Ä–µ–±—É–µ—Ç `"name": "table_name"` –≤ singular, –Ω–æ –Ω–µ –æ–±—ä—è—Å–Ω—è–µ—Ç –ø—Ä–∞–≤–∏–ª–∞
- ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—è column types
- ‚ùå –ù–µ —É–∫–∞–∑–∞–Ω—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –¥–ª–∏–Ω—É –∏–º–µ–Ω
- ‚ùå –ù–µ—Ç –ø—Ä–∏–º–µ—Ä–æ–≤ –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞

**–ü—Ä–∏–º–µ—Ä –æ—à–∏–±–∫–∏:**
```typescript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å "users" –∏–ª–∏ "user"
"name": "table_name",  // –ö–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç –æ–∂–∏–¥–∞–µ—Ç—Å—è?

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å —è–≤–Ω–æ
"name": "user",  // ALWAYS SINGULAR, snake_case
```

---

#### 2. **ai-import-suggestions** - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Gemini –≤–º–µ—Å—Ç–æ Lovable AI
**–§–∞–π–ª:** `supabase/functions/ai-import-suggestions/index.ts:5-6`

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå –ò—Å–ø–æ–ª—å–∑—É–µ—Ç GEMINI_API_KEY –≤–º–µ—Å—Ç–æ LOVABLE_API_KEY
- ‚ùå –ü—Ä—è–º–æ–π –≤—ã–∑–æ–≤ Google API –≤–º–µ—Å—Ç–æ ai.gateway.lovable.dev
- ‚ùå –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å —Å –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏
- ‚ùå –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç Google API

**–ö–æ–¥:**
```typescript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
const GEMINI_API_KEY = Deno.env.get('GEMINI_API_KEY');
const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/...';

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å
const LOVABLE_API_KEY = Deno.env.get('LOVABLE_API_KEY');
const AI_API_URL = 'https://ai.gateway.lovable.dev/v1/chat/completions';
```

---

#### 3. **generate-insights** - –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç AI –∞–Ω–∞–ª–∏–∑
**–§–∞–π–ª:** `supabase/functions/generate-insights/index.ts`

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¢–û–õ–¨–ö–û rule-based –∞–Ω–∞–ª–∏–∑ (if/else)
- ‚ùå –ù–ï–¢ –≤—ã–∑–æ–≤–æ–≤ AI –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–Ω—Å–∞–π—Ç–æ–≤
- ‚ùå –§—É–Ω–∫—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∞ "AI insights", –Ω–æ AI –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- ‚ùå –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∞–Ω–∞–ª–∏–∑–∞

**–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
```typescript
// ‚ùå –ù–ï–¢ AI –∞–Ω–∞–ª–∏–∑–∞:
// - –ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è –º–µ–∂–¥—É –∫–æ–ª–æ–Ω–∫–∞–º–∏
// - –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ —Ç—Ä–µ–Ω–¥–æ–≤
// - –ê–Ω–æ–º–∞–ª–∏–∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
// - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

// ‚úÖ –ù–£–ñ–ù–û: –¥–æ–±–∞–≤–∏—Ç—å AI –¥–ª—è:
const aiInsights = await callAI({
  data: tableData,
  schema: database.table_schemas,
  prompt: INSIGHTS_ANALYZER_PROMPT
});
```

---

#### 4. **telegram-natural-language** - –û–≥—Ä–æ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç —Å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º
**–§–∞–π–ª:** `supabase/functions/telegram-natural-language/index.ts:60-126`

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå 160+ —Å—Ç—Ä–æ–∫ –ø—Ä–æ–º–ø—Ç–∞ - —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π
- ‚ùå –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è –ø—Ä–∏–º–µ—Ä–æ–≤
- ‚ùå –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
- ‚ùå –°–º–µ—à–µ–Ω–∏–µ —Ä—É—Å—Å–∫–∏—Ö –∏ –∞–Ω–≥–ª–∏–π—Å–∫–∏—Ö –ø—Ä–∏–º–µ—Ä–æ–≤
- ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å–∏—Å—Ç–µ–º–∞—Ç–∏–∑–∞—Ü–∏—è

**–†–∞–∑–º–µ—Ä:**
```
–ü—Ä–æ–º–ø—Ç: ~4000 —Ç–æ–∫–µ–Ω–æ–≤
–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π: ~1000 —Ç–æ–∫–µ–Ω–æ–≤
–ò–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å: 75%
```

---

### ‚ö†Ô∏è –°–†–ï–î–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´:

#### 5. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –µ–¥–∏–Ω–æ–≥–æ —Å—Ç–∏–ª—è –ø—Ä–æ–º–ø—Ç–æ–≤**

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ö†Ô∏è –†–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
- ‚ö†Ô∏è –†–∞–∑–Ω—ã–µ —Å—Ç–∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏—è (imperative vs descriptive)
- ‚ö†Ô∏è –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–∞—è —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è
- ‚ö†Ô∏è –†–∞–∑–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ OUTPUT FORMAT

**–ü—Ä–∏–º–µ—Ä—ã –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏:**
```typescript
// ai-analyze-schema:
"OUTPUT FORMAT (JSON):"

// ai-import-suggestions:
"**Response Format (JSON):**"

// telegram-natural-language:
"–û—Ç–≤–µ—á–∞–π –¢–û–õ–¨–ö–û –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON —á–µ—Ä–µ–∑ tool call"

// ‚úÖ –î–û–õ–ñ–ù–û –ë–´–¢–¨ –ï–î–ò–ù–û–û–ë–†–ê–ó–ù–û
```

---

#### 6. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ AI**

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ö†Ô∏è –ù–µ—Ç retry –ª–æ–≥–∏–∫–∏ –¥–ª—è rate limits
- ‚ö†Ô∏è –ù–µ—Ç fallback –¥–ª—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ AI
- ‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ AI responses
- ‚ö†Ô∏è –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ—Ç–≤–µ—Ç–∞

---

#### 7. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –≤ –ø—Ä–æ–º–ø—Ç–∞—Ö**

**–§–∞–π–ª—ã:**
- `ai-analyze-schema` - –Ω–µ—Ç –ø—Ä–∏–º–µ—Ä–æ–≤ valid JSON
- `generate-insights` - –Ω–µ—Ç –ø—Ä–∏–º–µ—Ä–æ–≤ –∏–Ω—Å–∞–π—Ç–æ–≤
- `ai-create-schema` - –Ω–µ—Ç –ø—Ä–∏–º–µ—Ä–æ–≤ mapping

**–ß—Ç–æ –Ω—É–∂–Ω–æ:**
```typescript
// ‚ùå –ë–ï–ó –ü–†–ò–ú–ï–†–û–í (—Ç–µ–∫—É—â–µ–µ)
"Return JSON with entities array"

// ‚úÖ –° –ü–†–ò–ú–ï–†–ê–ú–ò (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
`Return JSON with entities array.

EXAMPLE INPUT:
"I need a blog with posts, authors, and comments"

EXAMPLE OUTPUT:
{
  "entities": [
    {
      "name": "post",
      "columns": [...]
    }
  ]
}`
```

---

### üü° –ú–ò–ù–û–†–ù–´–ï –ü–†–û–ë–õ–ï–ú–´:

#### 8. **–ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ temperature –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**

```typescript
// ai-analyze-schema:
temperature: 0.3  // ‚ùå –°–ª–∏—à–∫–æ–º –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ –¥–ª—è schema

// ai-import-suggestions:
temperature: 0.2  // ‚úÖ –•–æ—Ä–æ—à–æ

// telegram-natural-language:
// ‚ùå –ù–ï–¢ temperature –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

// ‚úÖ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:
// Schema generation: 0.1-0.2 (deterministic)
// NL understanding: 0.2-0.3 (structured)
// Insights: 0.5-0.7 (creative)
```

---

#### 9. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ versioning –ø—Ä–æ–º–ø—Ç–æ–≤**

**–ü—Ä–æ–±–ª–µ–º—ã:**
- üü° –ù–µ—Ç –≤–µ—Ä—Å–∏–π –ø—Ä–æ–º–ø—Ç–æ–≤
- üü° –ù–µ—Ç changelog –¥–ª—è –ø—Ä–æ–º–ø—Ç–æ–≤
- üü° –ù–µ—Ç A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- üü° –ù–µ—Ç –º–µ—Ç—Ä–∏–∫ –∫–∞—á–µ—Å—Ç–≤–∞

---

#### 10. **Hardcoded model names**

```typescript
// ‚ùå HARDCODED –≤–æ –≤—Å–µ—Ö —Ñ–∞–π–ª–∞—Ö:
model: 'google/gemini-2.5-flash'
model: 'gemini-2.0-flash-exp'

// ‚úÖ –î–û–õ–ñ–ù–û –ë–´–¢–¨:
const AI_MODEL = Deno.env.get('AI_MODEL') || 'google/gemini-2.5-flash';
```

---

## üìã –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô):
1. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å ai-import-suggestions (Gemini ‚Üí Lovable AI)
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å AI –≤ generate-insights
3. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å telegram-natural-language –ø—Ä–æ–º–ø—Ç
4. ‚úÖ –£–ª—É—á—à–∏—Ç—å ai-analyze-schema –ø—Ä–æ–º–ø—Ç

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–í–´–°–û–ö–ò–ô):
5. ‚úÖ –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∏–ª—å –≤—Å–µ—Ö –ø—Ä–æ–º–ø—Ç–æ–≤
6. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –∏ retry –ª–æ–≥–∏–∫—É
7. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã –≤ –ø—Ä–æ–º–ø—Ç—ã

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–°–†–ï–î–ù–ò–ô):
8. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å temperature –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
9. ‚úÖ –í—ã–Ω–µ—Å—Ç–∏ model names –≤ env variables
10. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –æ—Ç–≤–µ—Ç–æ–≤ AI

---

## üéØ –û–ñ–ò–î–ê–ï–ú–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- ‚úÖ –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å: 95% (–±—ã–ª–æ 60%)
- ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ AI –æ—Ç–≤–µ—Ç–æ–≤: +30%
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤: -40%
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫: 100% coverage
- ‚úÖ Maintainability: Grade A

---

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ü—Ä–∏–º–µ–ΩÔøΩÔøΩ—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è ‚Üí
