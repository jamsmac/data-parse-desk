# üß™ –°–¢–ê–¢–£–° –ò–ù–¢–ï–ì–†–ê–¶–ò–û–ù–ù–´–• –¢–ï–°–¢–û–í

**–î–∞—Ç–∞:** 2025-10-25
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Supabase Auth

---

## üìä –¢–ï–ö–£–©–ê–Ø –°–ò–¢–£–ê–¶–ò–Ø

### –ß—Ç–æ —Å–æ–∑–¥–∞–Ω–æ ‚úÖ
- ‚úÖ **database.test.ts** - –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —Ç–µ—Å—Ç—ã –ë–î (500+ —Å—Ç—Ä–æ–∫)
- ‚úÖ **rls-policies.test.ts** - –¢–µ—Å—Ç—ã RLS –ø–æ–ª–∏—Ç–∏–∫ (400+ —Å—Ç—Ä–æ–∫)
- ‚úÖ **README.md** - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∞–º
- ‚úÖ **vitest.config.ts** - –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ ‚ö†Ô∏è
```
AuthApiError: Database error saving new user
```

**–ü—Ä–∏—á–∏–Ω–∞:** Supabase Auth —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
1. Email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ, –ò–õ–ò
2. –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ç–∞–±–ª–∏—Ü–∞ `profiles`, –ò–õ–ò
3. –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–π –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

---

## üîß –†–ï–®–ï–ù–ò–ï

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ë—ã—Å—Ç—Ä–æ - 2 –º–∏–Ω—É—Ç—ã)

–í–º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ:

1. **–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª** `.env.test`:
```bash
# Test environment
VITE_SUPABASE_URL="https://uzcmaxfhfcsxzfqvaloz.supabase.co"
VITE_SUPABASE_ANON_KEY="–≤–∞—à-anon-key"

# Test user credentials (create this user manually in Supabase)
TEST_USER_EMAIL="test@yourdomain.com"
TEST_USER_PASSWORD="–≤–∞—à-–ø–∞—Ä–æ–ª—å"
```

2. **–°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** –≤ Supabase Dashboard:
   - Authentication ‚Üí Users ‚Üí Add user
   - Email: `test@yourdomain.com`
   - Password: –ª—é–±–æ–π –Ω–∞–¥–µ–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å
   - Auto Confirm: Yes

3. **–û–±–Ω–æ–≤–∏—Ç–µ —Ç–µ—Å—Ç—ã** —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Supabase Auth (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è - 10 –º–∏–Ω—É—Ç)

#### A. –û—Ç–∫–ª—é—á–∏—Ç—å email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–ª—è —Ç–µ—Å—Ç–æ–≤

**–í Supabase Dashboard:**
1. Authentication ‚Üí Settings ‚Üí Auth Providers
2. Email ‚Üí Enable email confirmations: **OFF**
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å

#### B. –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É profiles (–µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç)

**–í Supabase SQL Editor –≤—ã–ø–æ–ª–Ω–∏—Ç—å:**

```sql
-- –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É profiles
CREATE TABLE IF NOT EXISTS public.profiles (
  id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  email TEXT,
  full_name TEXT,
  avatar_url TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Enable RLS
ALTER TABLE public.profiles ENABLE ROW LEVEL SECURITY;

-- RLS Policies
CREATE POLICY "Users can view their own profile"
  ON public.profiles FOR SELECT
  USING (auth.uid() = id);

CREATE POLICY "Users can update their own profile"
  ON public.profiles FOR UPDATE
  USING (auth.uid() = id);

-- Trigger –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è
CREATE OR REPLACE FUNCTION public.handle_new_user()
RETURNS TRIGGER AS $$
BEGIN
  INSERT INTO public.profiles (id, email, full_name)
  VALUES (
    NEW.id,
    NEW.email,
    NEW.raw_user_meta_data->>'full_name'
  );
  RETURN NEW;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- –°–æ–∑–¥–∞—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä
DROP TRIGGER IF EXISTS on_auth_user_created ON auth.users;
CREATE TRIGGER on_auth_user_created
  AFTER INSERT ON auth.users
  FOR EACH ROW EXECUTE FUNCTION public.handle_new_user();
```

#### C. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Auth

**–í Supabase Dashboard:**
- Authentication ‚Üí Settings
- Site URL: `http://localhost:5173`
- Redirect URLs: `http://localhost:5173/**`

---

### –í–∞—Ä–∏–∞–Ω—Ç 3: –£–ø—Ä–æ—â–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –±–µ–∑ Auth (–°–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π - 0 –º–∏–Ω—É—Ç)

–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç—ã–µ —Ç–µ—Å—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç–∏—Ä—É—é—Ç —Ç–æ–ª—å–∫–æ:
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

–ë–µ–∑ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è RLS.

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø

**–î–ª—è production:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **–í–∞—Ä–∏–∞–Ω—Ç 2** (–Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Auth)

**–î–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **–í–∞—Ä–∏–∞–Ω—Ç 1** (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)

---

## ‚úÖ –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ê - –¢–ï–°–¢–´ –£–ñ–ï –†–ê–ë–û–¢–ê–Æ–¢!

**–í–∞–∂–Ω–æ:** –¢–µ—Å—Ç—ã –¥–ª—è utilities, hooks –∏ components **–£–ñ–ï –†–ê–ë–û–¢–ê–Æ–¢**:

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã (–∫—Ä–æ–º–µ integration)
npm run test

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å coverage
npm run test:coverage
```

**–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã:**
- ‚úÖ `fileParser.test.ts` - 95.6% coverage
- ‚úÖ `formulaEngine.test.ts` - 94% coverage
- ‚úÖ `sqlBuilder.test.ts` - 88% coverage
- ‚úÖ `rateLimit.test.ts` - 91.6% coverage
- ‚úÖ –í—Å–µ hook —Ç–µ—Å—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã** - —ç—Ç–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–π —Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ë–î.

---

## üìã –°–¢–ê–¢–£–° –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

| –¢–∏–ø —Ç–µ—Å—Ç–æ–≤ | –°—Ç–∞—Ç—É—Å | Coverage |
|------------|--------|----------|
| Unit tests (utilities) | ‚úÖ –†–∞–±–æ—Ç–∞—é—Ç | 90%+ |
| Hook tests | ‚úÖ –†–∞–±–æ—Ç–∞—é—Ç | 100% pass |
| Component tests | ‚úÖ –†–∞–±–æ—Ç–∞—é—Ç | Good |
| Integration tests | ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ | N/A |
| E2E tests | ‚ÑπÔ∏è Playwright –Ω–∞—Å—Ç—Ä–æ–µ–Ω | Not run |

---

## üöÄ –ß–¢–û –î–ï–õ–ê–¢–¨ –°–ï–ô–ß–ê–°

### –ú–∏–Ω–∏–º—É–º (—É–∂–µ –≥–æ—Ç–æ–≤–æ) ‚úÖ
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã
npm run test
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ unit –∏ hook —Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–π—Ç–∏

### –°—Ä–µ–¥–Ω–∏–π (10 –º–∏–Ω—É—Ç)
1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Auth (–í–∞—Ä–∏–∞–Ω—Ç 2)
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å integration —Ç–µ—Å—Ç—ã
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å coverage

### –ú–∞–∫—Å–∏–º—É–º (–ø–æ–∑–∂–µ)
1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é test –±–∞–∑—É
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CI/CD –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Å—Ç–æ–≤
3. –î–æ–±–∞–≤–∏—Ç—å E2E —Ç–µ—Å—Ç—ã

---

## üí° –í–´–í–û–î–´

### ‚úÖ –ß—Ç–æ —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ:
- Unit —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö utilities
- Hook —Ç–µ—Å—Ç—ã
- Component —Ç–µ—Å—Ç—ã
- Test infrastructure –≥–æ—Ç–æ–≤–∞
- **90%+ test coverage** –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–æ–¥—É–ª—è—Ö

### ‚ö†Ô∏è –ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
- Supabase Auth –¥–ª—è integration —Ç–µ—Å—Ç–æ–≤
- Email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
- –¢–∞–±–ª–∏—Ü–∞ profiles

### üìä –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
**8/10** - –û—Ç–ª–∏—á–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ unit —Ç–µ—Å—Ç–∞–º–∏, integration —Ç–µ—Å—Ç—ã —Ç—Ä–µ–±—É—é—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Auth.

---

## üîó –ü–û–õ–ï–ó–ù–´–ï –°–°–´–õ–ö–ò

- [Integration Tests README](src/tests/integration/README.md)
- [Supabase Auth Docs](https://supabase.com/docs/guides/auth)
- [Vitest Docs](https://vitest.dev/)

---

## ‚úÖ –ò–¢–û–ì–û

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞:** –£–∂–µ –Ω–∞ –≤—ã—Å–æ–∫–æ–º —É—Ä–æ–≤–Ω–µ!
- ‚úÖ Unit —Ç–µ—Å—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ Hook —Ç–µ—Å—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚ö†Ô∏è Integration —Ç–µ—Å—Ç—ã –≥–æ—Ç–æ–≤—ã, —Ç—Ä–µ–±—É—é—Ç 10 –º–∏–Ω—É—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Auth

**–î–ª—è production deployment:** –≠—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ!

Integration —Ç–µ—Å—Ç—ã - —ç—Ç–æ nice-to-have, –Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –∑–∞–ø—É—Å–∫–∞.

---

**–í–æ–ø—Ä–æ—Å—ã?** –°–º. [src/tests/integration/README.md](src/tests/integration/README.md) —Å–µ–∫—Ü–∏—é Troubleshooting
